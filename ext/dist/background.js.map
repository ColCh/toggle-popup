{"version":3,"sources":["/src/background.ts","/src/popup.ts","/src/youtube-popup.ts"],"names":[],"mappings":"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","file":"","sourcesContent":["import Popup from \"./popup\";\nimport YoutubePopup from \"./youtube-popup\";\n\nchrome.contextMenus.create({\n    title: \"Toggle PopUp\",\n});\n\nasync function main(info: chrome.contextMenus.OnClickData, tab: chrome.tabs.Tab) {\n    const isYoutube = YoutubePopup.isYoutube(tab);\n\n    let popup;\n\n    if (isYoutube) {\n        popup = new YoutubePopup(tab);\n    } else {\n        popup = new Popup(tab);\n    }\n\n    const isInPopupMode = await popup.isInPopUpMode();\n\n    if (isInPopupMode) {\n        await popup.toWindow();\n    } else {\n        await popup.toPopup();\n    }\n}\n\nconst handleClick = (info: chrome.contextMenus.OnClickData, tab: chrome.tabs.Tab) => {\n    main(info, tab).catch((reason) => {\n        // tslint:disable-next-line:no-console\n        console.error(\"There was en error running toggle-popup\", reason);\n    });\n};\n\nchrome.contextMenus.onClicked.addListener(handleClick);\n","interface IPopupContextData {\n    windowId: number;\n    index: number;\n}\n\nclass Popup {\n    public static dataKey = \"toggle_popup_window\";\n\n    public static windowTypes = {\n        normal: \"normal\",\n        popup: \"popup\",\n    };\n\n    public tab: chrome.tabs.Tab;\n\n    constructor(tab: chrome.tabs.Tab) {\n        this.tab = tab;\n    }\n\n    public isInPopUpMode() {\n        return new Promise((res) => {\n            chrome.windows.getCurrent((window: chrome.windows.Window) => {\n                const isPopup = window.type === Popup.windowTypes.popup;\n                res(isPopup);\n            });\n        });\n    }\n\n    public executeFunction(func: any, args: any) {\n        return new Promise((res) => {\n            const code = `; 'use strict'; var res = (${func.toString()}).apply(null, ${JSON.stringify(args)}); res;`;\n            chrome.tabs.executeScript(this.tab.id, {\n                code,\n            }, (results: [any]) => {\n                res(results ? results[0] : undefined);\n            });\n        });\n    }\n\n    public updateProperties(properties: chrome.tabs.UpdateProperties) {\n        return new Promise((res) => {\n            chrome.tabs.update(this.tab.id, properties, () => {\n                res();\n            });\n        });\n    }\n\n    public async toPopup(options: chrome.windows.CreateData = {}): Promise<chrome.windows.Window> {\n        const window = await this.createWindow({\n            ...options,\n            type: Popup.windowTypes.popup,\n        });\n\n        await this.focusWindow(window.id);\n\n        await this.saveWindowContext();\n\n        return window;\n    }\n\n    public async toWindow(options: chrome.windows.CreateData = {}): Promise<chrome.windows.Window> {\n        const window = await this.createWindow({\n            ...options,\n            type: Popup.windowTypes.normal,\n        });\n\n        const data = await this.restoreWindowContext();\n\n        try {\n            await this.moveTabToWindow(data);\n        } catch (e) {\n            // ignore if we can't move tab back to original window\n        }\n\n        return window;\n    }\n\n    private async focusWindow(windowId: number) {\n        return new Promise((res) => {\n            chrome.windows.update(windowId, {\n                drawAttention: true,\n                focused: true,\n            }, () => {\n                res();\n            });\n        });\n    }\n\n    private createWindow(options: chrome.windows.CreateData): Promise<chrome.windows.Window> {\n        return new Promise((res) => {\n            chrome.windows.create({\n                ...options,\n                incognito: this.tab.incognito,\n                tabId: this.tab.id,\n            }, (window) => {\n                res(window);\n            });\n        });\n    }\n\n    private moveTabToWindow(moveProperties: chrome.tabs.MoveProperties) {\n        return new Promise((res, rej) => {\n            chrome.windows.get(moveProperties.windowId, (window) => {\n                if (!window || chrome.runtime.lastError) {\n                    rej(new ReferenceError(`Non-existing window with id <${moveProperties.windowId}>. Message:\n                        ${chrome.runtime.lastError.message}`));\n                    return;\n                }\n                chrome.tabs.move(this.tab.id, moveProperties, () => {\n                    res();\n                });\n            });\n        });\n    }\n\n    private async saveWindowContext() {\n        const data = {\n            index: this.tab.index,\n            windowId: this.tab.windowId,\n        } as IPopupContextData;\n\n        const { dataKey } = Popup;\n\n        /**\n         * Executes as eval'ed string in the context of youtube page\n         */\n        // tslint:disable:no-shadowed-variable\n        await this.executeFunction((\n            dataKey: string,\n            data: object,\n        ) => {\n            document.body.dataset[dataKey] = JSON.stringify(data);\n        }, [dataKey, data]);\n        // tslint:enable:no-shadowed-variable\n    }\n\n    private async restoreWindowContext(): Promise<IPopupContextData> {\n        const { dataKey } = Popup;\n\n        /**\n         * Executes as eval'ed string in the context of youtube page\n         */\n        // tslint:disable:no-shadowed-variable\n        return await this.executeFunction((\n            dataKey: string,\n        ) => {\n            const dataStr = document.body.dataset[dataKey];\n            delete document.body.dataset[dataKey];\n\n            return JSON.parse(dataStr);\n        }, [dataKey]) as IPopupContextData;\n        // tslint:enable:no-shadowed-variable\n    }\n}\n\nexport default Popup;\n","import Popup from \"./popup\";\n\nclass YoutubePopup extends Popup {\n    /**\n     * from youtube style file\n     */\n    public static popupDimensions = {\n        height: 260,\n        width: 426,\n    };\n\n    // language=CSS\n    public static stylesToInject = `\n        .toggle-popup--active #masthead-positioner {\n          display: none !important;\n        }\n        .toggle-popup--active #masthead-positioner-height-offset {\n          display: none !important;\n        }\n        .toggle-popup--active {\n          overflow-x: hidden !important;\n        }\n        .toggle-popup--active #player {\n          top: 0 !important;\n        }\n    `;\n\n    public static styleElementId = \"toggle-popup-styles-element\";\n\n    public static activeClassName = \"toggle-popup--active\";\n\n    public static isYoutube(tab: chrome.tabs.Tab) {\n        return /youtube\\.com/.test(tab.url);\n    }\n\n    public static getPopupPosition() {\n        const { width, height } = YoutubePopup.popupDimensions;\n\n        return {\n            height,\n            left: screen.availWidth - width,\n            top: 0,\n            width,\n        };\n    }\n\n    constructor(tab: chrome.tabs.Tab) {\n        super(tab);\n    }\n\n    public async toPopup(options: chrome.windows.CreateData = {}): Promise<chrome.windows.Window> {\n\n        const youtubeOptions = {\n            ...options,\n            ...YoutubePopup.getPopupPosition(),\n        };\n        const window = await super.toPopup(youtubeOptions);\n\n        const { stylesToInject, activeClassName, styleElementId } = YoutubePopup;\n\n        /**\n         * Executes as eval'ed string in the context of youtube page\n         */\n        // tslint:disable:no-shadowed-variable\n        await this.executeFunction((\n            stylesToInject: string,\n            activeClassName: string,\n            styleElementId: string,\n        ) => {\n            document.body.classList.add(activeClassName);\n\n            const style = document.createElement(\"style\");\n            style.type = \"text/css\";\n            const styleText = document.createTextNode(stylesToInject);\n            style.appendChild(styleText);\n            style.id = styleElementId;\n            document.head.appendChild(style);\n\n            // scroll up to video\n            setTimeout(() => {\n                scrollTo(0, 0);\n            }, 1);\n        }, [stylesToInject, activeClassName, styleElementId]);\n        // tslint:enable:no-shadowed-variable\n\n        return window;\n    }\n\n    public async toWindow(options: chrome.windows.CreateData = {}): Promise<chrome.windows.Window> {\n        const window = await super.toWindow(options);\n        const { activeClassName, styleElementId } = YoutubePopup;\n\n        /**\n         * Executes as eval'ed string in the context of youtube page\n         */\n        // tslint:disable:no-shadowed-variable\n        await this.executeFunction((\n            activeClassName: string,\n            styleElementId: string,\n        ) => {\n\n            document.body.classList.remove(activeClassName);\n\n            const style = document.getElementById(styleElementId);\n            style.innerHTML = \"\";\n            style.parentNode.removeChild(style);\n        }, [activeClassName, styleElementId]);\n        // tslint:enable:no-shadowed-variable\n\n        await this.updateProperties({\n            selected: true,\n        });\n\n        return window;\n    }\n}\n\nexport default YoutubePopup;\n"]}